<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Bug Hunter V2 ‚Äî vashxd</title>
  <style>
    :root { color-scheme: dark; }
    body {
      margin: 0;
      background: radial-gradient(1200px 700px at 30% 10%, #1b1f2a, #0b0e14);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color: #e9eef7;
      overflow: hidden;
      touch-action: manipulation;
    }
    canvas { display:block; margin:0 auto; }

    .hud {
      position: fixed;
      left: 12px;
      top: 12px;
      display: grid;
      gap: 10px;
      user-select: none;
      pointer-events: none;
      font-size: 13px;
      opacity: 0.96;
      z-index: 5;
    }
    .pill {
      display: inline-flex;
      gap: 10px;
      align-items: center;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.10);
      backdrop-filter: blur(8px);
      padding: 10px 12px;
      border-radius: 999px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
      width: max-content;
    }
    .pill strong { letter-spacing: -0.01em; }

    .k {
      display:inline-flex;
      min-width: 22px;
      height: 22px;
      align-items:center;
      justify-content:center;
      border-radius: 7px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.25);
      font-weight: 900;
      font-size: 12px;
      padding: 0 6px;
    }

    .legend {
      position: fixed;
      right: 12px;
      top: 12px;
      display: grid;
      gap: 10px;
      user-select: none;
      pointer-events: none;
      font-size: 12px;
      text-align: right;
      opacity: 0.96;
      z-index: 5;
    }
    .legend .row { display:flex; gap:10px; justify-content:flex-end; align-items:center; }
    .dot { width:10px; height:10px; border-radius: 50%; display:inline-block; }
    .dot.c { background:#ff4d6d; box-shadow:0 0 12px rgba(255,77,109,0.45); }
    .dot.m { background:#ffb703; box-shadow:0 0 12px rgba(255,183,3,0.35); }
    .dot.n { background:#80ed99; box-shadow:0 0 12px rgba(128,237,153,0.35); }

    .center {
      position: fixed;
      inset: 0;
      display:flex;
      align-items:center;
      justify-content:center;
      pointer-events:none;
      text-align:center;
      padding: 16px;
      z-index: 10;
    }
    .card {
      pointer-events:none;
      width: min(760px, 100%);
      border-radius: 22px;
      padding: 18px 16px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.10);
      backdrop-filter: blur(10px);
      box-shadow: 0 24px 80px rgba(0,0,0,0.45);
    }
    .title { font-size: 28px; font-weight: 950; letter-spacing: -0.03em; margin: 0 0 6px; }
    .sub { margin: 0 0 12px; opacity: 0.92; line-height:1.4; }
    .tip { opacity: 0.86; font-size: 13px; line-height:1.5; margin: 10px 0 0; }
    .hide { display:none; }

    .grid {
      display:grid;
      gap: 12px;
      grid-template-columns: 1.2fr 0.8fr;
      align-items: start;
      margin-top: 10px;
    }
    @media (max-width: 720px) {
      .grid { grid-template-columns: 1fr; }
      .legend { display:none; }
    }

    .panel {
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.18);
      padding: 12px;
    }
    .panel h3 {
      margin: 0 0 8px;
      font-size: 13px;
      letter-spacing: 0.02em;
      text-transform: uppercase;
      opacity: 0.9;
    }
    .lb {
      display:grid;
      gap: 8px;
      font-size: 13px;
      opacity: 0.95;
    }
    .lb .item {
      display:flex;
      justify-content: space-between;
      gap: 12px;
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.08);
      background: rgba(255,255,255,0.03);
    }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

    /* Mobile controls */
    .controls {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 12px 12px 14px;
      display: none;
      gap: 10px;
      z-index: 8;
      user-select: none;
    }
    .controls .row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
    }
    .btn {
      -webkit-tap-highlight-color: transparent;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.07);
      border-radius: 18px;
      padding: 14px 12px;
      color: #e9eef7;
      font-weight: 900;
      letter-spacing: -0.01em;
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.35);
      touch-action: manipulation;
    }
    .btn:active { transform: translateY(1px); }
    .btn.c { border-color: rgba(255,77,109,0.35); }
    .btn.m { border-color: rgba(255,183,3,0.30); }
    .btn.n { border-color: rgba(128,237,153,0.30); }
    .btn .badge {
      width: 10px; height: 10px; border-radius: 50%;
      display:inline-block;
    }
    .btn.c .badge { background:#ff4d6d; box-shadow:0 0 12px rgba(255,77,109,0.45); }
    .btn.m .badge { background:#ffb703; box-shadow:0 0 12px rgba(255,183,3,0.35); }
    .btn.n .badge { background:#80ed99; box-shadow:0 0 12px rgba(128,237,153,0.35); }

    .controls .meta {
      display:flex;
      gap: 10px;
      margin-top: 10px;
    }
    .btn.sm {
      flex: 1;
      padding: 12px 10px;
      border-radius: 16px;
      font-weight: 800;
      opacity: 0.95;
    }

    @media (max-width: 900px), (pointer: coarse) {
      .controls { display: grid; }
      /* add breathing space so miss line isn't hidden by buttons */
      body { padding-bottom: 116px; }
    }

    a { color: #9ae6ff; }
  </style>
</head>
<body>
  <canvas id="game"></canvas>

  <div class="hud">
    <div class="pill">
      <strong>Bug Hunter V2</strong>
      <span style="opacity:.8">|</span>
      <span>Score: <strong id="score">0</strong></span>
      <span>Streak: <strong id="streak">0</strong></span>
      <span>HP: <strong id="hp">5</strong></span>
      <span>Lvl: <strong id="lvl">1</strong></span>
      <span style="opacity:.8">|</span>
      <span>üîä <strong id="snd">On</strong></span>
    </div>
    <div class="pill" style="opacity:.92">
      <span><span class="k">1</span> Critical</span>
      <span><span class="k">2</span> Major</span>
      <span><span class="k">3</span> Minor</span>
      <span style="opacity:.8">|</span>
      <span><span class="k">P</span> Pause</span>
      <span><span class="k">R</span> Restart</span>
      <span><span class="k">M</span> Mute</span>
    </div>
  </div>

  <div class="legend">
    <div class="pill">
      <div class="row"><span class="dot c"></span><span>CRITICAL</span></div>
      <div class="row"><span class="dot m"></span><span>MAJOR</span></div>
      <div class="row"><span class="dot n"></span><span>MINOR</span></div>
    </div>
  </div>

  <div class="center" id="overlay">
    <div class="card">
      <h1 class="title" id="ovTitle">üß™ Bug Hunter V2</h1>
      <p class="sub" id="ovSub">
        Bugs est√£o caindo! Classifique com <strong>1</strong>, <strong>2</strong> ou <strong>3</strong> antes de passar da linha.
        <br/>No celular, use os bot√µes embaixo.
      </p>

      <div class="grid">
        <div class="panel">
          <h3>Como jogar</h3>
          <div class="tip">
            ‚úÖ Acerto = pontos + streak (combo)<br/>
            ‚ùå Errado = -1 HP<br/>
            ‚¨áÔ∏è Miss (passou da linha) = -2 HP<br/>
            <br/>
            <span class="mono">P</span> pausa ‚Ä¢ <span class="mono">R</span> reinicia ‚Ä¢ <span class="mono">M</span> mute
          </div>
        </div>

        <div class="panel">
          <h3>üèÜ Ranking (Top 5)</h3>
          <div class="lb" id="lb"></div>
          <div class="tip" style="margin-top:8px; opacity:.78">
            O ranking salva no seu navegador (localStorage).
          </div>
        </div>
      </div>

      <p class="tip" style="margin-top:12px">
        Pressione qualquer tecla (ou toque em um bot√£o) para come√ßar.
      </p>
    </div>
  </div>

  <!-- Mobile Controls -->
  <div class="controls" id="controls">
    <div class="row">
      <button class="btn c" data-hit="1" aria-label="Critical">
        <span class="badge"></span> 1 ‚Ä¢ Critical
      </button>
      <button class="btn m" data-hit="2" aria-label="Major">
        <span class="badge"></span> 2 ‚Ä¢ Major
      </button>
      <button class="btn n" data-hit="3" aria-label="Minor">
        <span class="badge"></span> 3 ‚Ä¢ Minor
      </button>
    </div>
    <div class="meta">
      <button class="btn sm" data-action="pause">Pausar</button>
      <button class="btn sm" data-action="restart">Reiniciar</button>
      <button class="btn sm" data-action="mute">Som</button>
    </div>
  </div>

<script>
(() => {
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");

  const ui = {
    score: document.getElementById("score"),
    streak: document.getElementById("streak"),
    hp: document.getElementById("hp"),
    lvl: document.getElementById("lvl"),
    snd: document.getElementById("snd"),
    overlay: document.getElementById("overlay"),
    ovTitle: document.getElementById("ovTitle"),
    ovSub: document.getElementById("ovSub"),
    lb: document.getElementById("lb"),
    controls: document.getElementById("controls"),
  };

  // ---- audio (tiny synth, no files)
  let audioCtx = null;
  let soundOn = true;

  function ensureAudio() {
    if (!audioCtx) {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }
    if (audioCtx.state === "suspended") audioCtx.resume();
  }
  function beep(freq=440, dur=0.06, type="sine", gain=0.06) {
    if (!soundOn) return;
    try {
      ensureAudio();
      const t0 = audioCtx.currentTime;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = type;
      o.frequency.setValueAtTime(freq, t0);
      g.gain.setValueAtTime(gain, t0);
      g.gain.exponentialRampToValueAtTime(0.0001, t0 + dur);
      o.connect(g).connect(audioCtx.destination);
      o.start(t0);
      o.stop(t0 + dur);
    } catch {}
  }
  function sfx(type) {
    if (type === "hit") { beep(740,0.05,"triangle",0.05); beep(980,0.04,"triangle",0.04); }
    if (type === "wrong") { beep(180,0.08,"sawtooth",0.05); }
    if (type === "miss") { beep(120,0.10,"square",0.05); }
    if (type === "lvl") { beep(520,0.06,"triangle",0.05); beep(780,0.06,"triangle",0.05); beep(1040,0.07,"triangle",0.05); }
    if (type === "over") { beep(220,0.10,"sine",0.05); beep(170,0.14,"sine",0.05); }
  }

  // ---- sizing
  function resize() {
    const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    const w = Math.min(window.innerWidth, 980);
    const h = Math.min(window.innerHeight, 760);
    canvas.width = Math.floor(w * dpr);
    canvas.height = Math.floor(h * dpr);
    canvas.style.width = w + "px";
    canvas.style.height = h + "px";
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  }
  window.addEventListener("resize", resize, { passive: true });
  resize();

  // ---- leaderboard (localStorage)
  const LB_KEY = "bugHunterV2_leaderboard";
  function loadLB() {
    try {
      const raw = localStorage.getItem(LB_KEY);
      const list = raw ? JSON.parse(raw) : [];
      if (!Array.isArray(list)) return [];
      return list
        .filter(x => x && typeof x.score === "number" && typeof x.when === "number")
        .sort((a,b) => b.score - a.score)
        .slice(0,5);
    } catch { return []; }
  }
  function saveLB(list) {
    try { localStorage.setItem(LB_KEY, JSON.stringify(list.slice(0,5))); } catch {}
  }
  function fmtDate(ts) {
    try {
      return new Date(ts).toLocaleDateString(undefined, { year:"2-digit", month:"2-digit", day:"2-digit" });
    } catch { return ""; }
  }
  function renderLB() {
    const list = loadLB();
    const html = list.length ? list.map((x,i) => `
      <div class="item">
        <span>#${i+1} <span style="opacity:.9">${fmtDate(x.when)}</span></span>
        <strong class="mono">${x.score}</strong>
      </div>
    `).join("") : `<div class="tip" style="opacity:.8">Sem scores ainda. Jogue e entre no top 5 üòà</div>`;
    ui.lb.innerHTML = html;
  }
  function maybeAddScore(finalScore) {
    const list = loadLB();
    list.push({ score: finalSc
